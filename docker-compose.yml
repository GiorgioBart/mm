version: "3.3"

services:
  mm:
    image: misi/mm:v3.2
    working_dir: /opt/multiparty-meeting/server
    entrypoint: ./mm_entrypoint.sh
    restart: unless-stopped
    image: misi/mm:latest
    environment:
      - BASEDIR=/opt
      - MM=multiparty-meeting
      - NODE_ENV=production
    volumes:
      - ./configs/server:/opt/multiparty-meeting/server/config
      - ./configs/app:/opt/multiparty-meeting/server/public/config
      - ./certs:/opt/multiparty-meeting/server/certs
      - ./images:/opt/multiparty-meeting/server/public/images
      - ./mm_entrypoint.sh:/opt/multiparty-meeting/server/mm_entrypoint.sh
    network_mode: "host"
    stdin_open: true
    tty: true
  redis:
    image: redis
    network_mode: "host"
    entrypoint: redis-server /usr/local/etc/redis/redis.conf
    restart: unless-stopped
    volumes:
      - ./configs/redis:/usr/local/etc/redis
  coturn:
    image: instrumentisto/coturn
    network_mode: "host"
    stop_signal: SIGKILL
    restart: unless-stopped
    volumes:
     - ./coturn.conf:/etc/coturn/turnserver.conf
  node_exporter:
    image: prom/node-exporter
    network_mode: "host"
    restart: unless-stopped


